(function(b,k){typeof exports=="object"&&typeof module<"u"?k(exports,require("localforage")):typeof define=="function"&&define.amd?define(["exports","localforage"],k):(b=typeof globalThis<"u"?globalThis:b||self,k(b.Ombor={},b.localforage))})(this,(function(b,k){"use strict";function B(i){if(i){if(typeof i!="string")return this.userErrors.push("Collection() metodidagi to'plam nomi string bo'lishi kerak, object, number yoki boolean emas."),this;{this.collectionName=i;const t=this.dbName;return i in this.lf||(this.lf[i]=k.createInstance({driver:k.INDEXEDDB,name:t,storeName:i})),this}}else return this.userErrors.push("Collection() metodida to'plam nomi ko'rsatilmagan"),this}function O(i){return i?typeof i!="string"&&typeof i!="object"?this.userErrors.push("Doc() metodida ko'rsatilgan document mezonlari number yoki boolean bo'lmasligi kerak. Kalitli string yoki mezonlarga ega bo'lgan objectdan foydalaning. Masalan: {id: 1}."):this.docSelectionCriteria=i:this.userErrors.push("Doc() metodida belgilangan document mezonlari yo'q. Kalitli string yoki mezonlarga ega bo'lgan objectdan foydalaning. Masalan: {id: 1}."),this}function q(i,t){return i?typeof i!="string"?this.userErrors.push(`OrderBy() metodidagi birinchi parametr String (maydon nomi) bo'lishi kerak. Masalan: "ism".`):this.orderByProperty=i:this.userErrors.push(`OrderBy() metodida maydon nomi ko'rsatilmagan. Stringdan foydalaning. Masalan: "ism".`),t&&(t!=="asc"&&t!=="desc"?this.userErrors.push("OrderBy() metodidagi ikkinchi parametr 'asc' yoki 'desc' va string bo'lishi kerak."):this.orderByDirection=t),this}function D(i){return i==null?this.userErrors.push("Limit() metodida integer(raqam) ko'rsatilmagan."):Number.isInteger(i)?this.limitBy=Math.max(0,i):this.userErrors.push("limit() metodidagi limit parametri float, boolean, string yoki objekt emas, balki butun son (masalan, 3) bo'lishi kerak."),this}function p(i,t){return t==null?i===t:i==null?!1:Object.keys(t).every(e=>typeof t[e]=="object"&&t[e]!==null?p(i[e],t[e]):t[e]===i[e])}const c={baseStyle:`
    padding: 2px 5px;
    background-color: #124F5C;
    border-radius: 4px;
    color: white;
  `,colors:{log:"#124F5C",error:"#ed2939",warn:"#f39c12"},log(i,t){if(this.config&&this.config.debug){const e=c.baseStyle+`background-color: ${c.colors.log}`;console.log("%cOmbor",e,i)}},error(i,t){if(this.config&&this.config.debug){const e=c.baseStyle+`background-color: ${c.colors.error}`;console.error("%cOmbor",e,i)}},warn(i,t){if(this.config&&this.config.debug){const e=c.baseStyle+`background-color: ${c.colors.warn}`;console.warn("%cOmbor",e,i)}}};function f(){this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.userErrors=[]}function S(){let i;return!this.collectionName&&!this.docSelectionCriteria?i="db":this.collectionName&&!this.docSelectionCriteria?i="collection":this.collectionName&&this.docSelectionCriteria&&(i="doc"),i}function $(){for(let i=0;i<this.userErrors.length;i++)c.error.call(this,this.userErrors[i]);f.call(this)}function x(i={keys:!1}){if(this.getCollection=()=>{const t=this.collectionName,e=this.orderByProperty,n=this.orderByDirection,l=i.filter,o=this.limitBy;let a=[];return this.lf[t].iterate((r,s)=>{let u={};i.keys?u={key,data:r}:u=r,l?p(r,l)&&a.push(u):a.push(u)}).then(()=>{let r=`"${t}" nomli collection olindi`;return e&&(r+=`, "${e}" orqali tartiblandi`,i.keys?a.sort((s,u)=>{if(!s.data.hasOwnProperty(e)||!u.data.hasOwnProperty(e))return 0;const m=s.data[e],g=u.data[e];return m==null?1:g==null?-1:typeof m=="number"&&typeof g=="number"?m-g:m.toString().localeCompare(g.toString())}):a.sort((s,u)=>{if(!s.hasOwnProperty(e)||!u.hasOwnProperty(e))return 0;const m=s[e],g=u[e];return m==null?1:g==null?-1:typeof m=="number"&&typeof g=="number"?m-g:m.toString().localeCompare(g.toString())})),n=="desc"&&(r+=" (descending)",a.reverse()),o!=null&&(r+=`, ${o} ta document(lar)gacha checklandi`,a=a.splice(0,o)),r+=":",c.log.call(this,r,a),f.call(this),a})},this.getDocument=()=>{const t=this.collectionName,e=this.docSelectionCriteria,n=[];let l;return this.getDocumentByCriteria=()=>this.lf[t].iterate((o,a)=>{p(o,e)&&n.push(o)}).then(()=>n.length?(l=n[0],c.log.call(this,`${JSON.stringify(e)} bilan document olindi:`,l),f.call(this),l):(c.error.call(this,`${JSON.stringify(e)} bilan "${t}" nomli collectionida documentlar topilmadi.`),f.call(this),l)),this.getDocumentByKey=()=>this.lf[t].getItem(e).then(o=>(l=o,l?c.log.call(this,`${JSON.stringify(e)} bilan document olindi:`,l):c.error.call(this,`${JSON.stringify(e)} kaliti bilan "${t}" nomli collectionda document topilmadi.`),f.call(this),l)).catch(o=>{c.error.call(this,`${JSON.stringify(e)} kaliti bilan "${t}" nomli collectionda document topilmadi.`),f.call(this)}),typeof e=="object"?this.getDocumentByCriteria():this.getDocumentByKey()},typeof i=="object"&&!(i instanceof Array)?i.hasOwnProperty("keys")?typeof i.keys!="boolean"&&this.userErrors.push("get() metodiga uzatilgan keys booleaniga true yoki false qiymat berilishi kerak. String yoki number emas."):this.userErrors.push("get() metodiga uzatilgan object true yoki false qiymatli keys boolean bo'lishi kerak. Masalan: { keys: true }"):this.userErrors.push("get() metodiga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas. Objectda true yoki false qiymatli boolean bo'lishi kerak. Masalan: {keys: true}."),this.userErrors.length)return $.call(this),null;{const t=S.call(this);if(t=="collection")return this.getCollection();if(t=="doc")return this.getDocument()}}const h=[];for(let i=0;i<256;++i)h.push((i+256).toString(16).slice(1));function J(i,t=0){return(h[i[t+0]]+h[i[t+1]]+h[i[t+2]]+h[i[t+3]]+"-"+h[i[t+4]]+h[i[t+5]]+"-"+h[i[t+6]]+h[i[t+7]]+"-"+h[i[t+8]]+h[i[t+9]]+"-"+h[i[t+10]]+h[i[t+11]]+h[i[t+12]]+h[i[t+13]]+h[i[t+14]]+h[i[t+15]]).toLowerCase()}let N;const _=new Uint8Array(16);function z(){if(!N){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");N=crypto.getRandomValues.bind(crypto)}return N(_)}const C={};function w(i,t,e){let n;{const l=Date.now(),o=z();I(C,l,o),n=P(o,C.msecs,C.seq,t,e)}return t??J(n)}function I(i,t,e){return i.msecs??=-1/0,i.seq??=0,t>i.msecs?(i.seq=e[6]<<23|e[7]<<16|e[8]<<8|e[9],i.msecs=t):(i.seq=i.seq+1|0,i.seq===0&&i.msecs++),i}function P(i,t,e,n,l=0){if(i.length<16)throw new Error("Random bytes length must be >= 16");if(!n)n=new Uint8Array(16),l=0;else if(l<0||l+16>n.length)throw new RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);return t??=Date.now(),e??=i[6]*127<<24|i[7]<<16|i[8]<<8|i[9],n[l++]=t/1099511627776&255,n[l++]=t/4294967296&255,n[l++]=t/16777216&255,n[l++]=t/65536&255,n[l++]=t/256&255,n[l++]=t&255,n[l++]=112|e>>>28&15,n[l++]=e>>>20&255,n[l++]=128|e>>>14&63,n[l++]=e>>>6&255,n[l++]=e<<2&255|i[10]&3,n[l++]=i[11],n[l++]=i[12],n[l++]=i[13],n[l++]=i[14],n[l++]=i[15],n}function d(i,t){return f.call(this),c.log.call(this,i,t),{success:!0,message:i,data:t}}function y(i){return f.call(this),c.error.call(this,i),`Xatolik: ${i}`}function Q(i,t){if(i?typeof i=="object"&&!(i instanceof Array)||this.userErrors.push("add() metodiga uzatilgan ma'lumot object bo'lishi kerak. Array, string, number yoki boolean emas."):this.userErrors.push(`add() metodida ma'lumot yo'q. Siz objectdan foydalanishingiz kerak, misol: { id: 1, ism: "Otabek", yosh: 19 }`),this.userErrors.length)$.call(this);else{const e=this.collectionName;return new Promise((n,l)=>{let o=null;return t?o=t:o=w(),this.lf[e].setItem(o,i).then(()=>{n(d.call(this,`"${e}" nomli collectionga yangi document qo'shildi.`,{key:o,data:i}))}).catch(a=>{l(y.call(this,`"${e}" nomli collectionga yangi document qo'shilmadi.`))})})}}function E(i){for(let t=1;t<arguments.length;t++)for(const e in arguments[t]){const n=arguments[t][e];i[e]=n}return i}function j(i){const t=this.collectionName,e=this.docSelectionCriteria;return new Promise((n,l)=>{this.updateDocumentByCriteria=()=>{const o=[];this.lf[t].iterate((a,r)=>{if(p(a,e)){const s=E(a,i);o.push({key:r,newDocument:s})}}).then(()=>{if(!o.length){c.error.call(this,`${JSON.stringify(e)} bilan ${t} collectionida documentlar topilmadi.`),n(d.call(this,`${JSON.stringify(e)} dagi "${t}" collectionida 0 document yangilandi.`,i));return}o.length>1&&c.warn.call(this,`${JSON.stringify(e)} bilan yangilash uchun (${o.length}) ta document(lar) topildi.`)}).then(()=>{o.length&&o.forEach((a,r)=>{this.lf[t].setItem(a.key,a.newDocument).then(s=>{r===o.length-1&&n(d.call(this,`${JSON.stringify(e)} dagi "${t}" collectionida ${o.length} document${o.length>1?"lar":""} yangilandi.`,i))}).catch(s=>{l(y.call(this,`${t} collectionidagi ${o.length} ta document yangilanmadi.`))})})})},this.updateDocumentByKey=()=>{let o={};this.lf[t].getItem(e).then(a=>{o=E(value,i),this.lf[t].setItem(e,o),n(d.call(this,`"${t}" collectionidagi document ${JSON.stringify(e)} kaliti bilan yangilandi.`,o))}).catch(a=>{l(y.call(this,`"${t}" collectionida ${JSON.stringify(e)} kalitli document topilmadi.`))})},i?typeof i=="object"&&!(i instanceof Array)||this.userErrors.push("Update() ga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas."):this.userErrors.push('Update() methodi uchun yangilanish objecti taqdim etilmagan. Objectdan foydalaning. Masalan: {ism: "Otabek"}.'),this.userErrors.length?$.call(this):typeof e=="object"?this.updateDocumentByCriteria():this.updateDocumentByKey()})}function K(i,t={keys:!1}){const e=this.collectionName,n=this.docSelectionCriteria,l=S.call(this);return new Promise((o,a)=>{if(this.setCollection=()=>{this.lf[e].clear().then(()=>{if(!t.keys)i.forEach(r=>{this.add(r)}),o(d.call(this,`"${e}" nomli collectionda ${i.length} ta document o'rnatildi.`,i));else{console.log("Kalitlar taqdim etildi");let r=0;i.forEach(s=>{s.hasOwnProperty("_key")||r++}),r?a(y.call(this,".set() metodiga array ichida berilgan documentlarning har birida string bo'lgan _key property bo'lishi kerak.")):(i.forEach(s=>{const u=s._key;delete s._key,this.add(s,u)}),o(d.call(this,`"${e}" nomli collectionda ${i.length} ta document bilan (qayta yozish orqali) o'rnatildi.`,i)))}}).catch(r=>{a(y.call(this,`${JSON.stringify(i)} ma'lumotlari bilan ${e} collectioni (qayta yozish) orqali o'rnatilmadi.`))})},this.setDocument=()=>(this.setDocumentByCriteria=()=>{const r=[];this.lf[e].iterate((s,u)=>{p(s,n)&&r.push({key:u,newDocument:i})}).then(()=>{r.length||a(y.call(this,`${e} collectionida ${JSON.stringify(n)} bilan documentlar topilmadi.`)),r.length>1&&c.warn.call(this,`O'rnatish uchun ${JSON.stringify(n)} bilan (${r.length}) ta document topildi.`)}).then(()=>{r.forEach((s,u)=>{this.lf[e].setItem(s.key,s.newDocument).then(m=>{u===r.length-1&&o(d.call(this,`${JSON.stringify(n)} bilan "${e}" collectionida ${r.length} ta document${r.length>1?"lar":""} (qayta yozish) orqali o'rnatildi.`,i))}).catch(m=>{a(y.call(this,`${r.length} ta document ${e} collectioniga (qayta yozish) orqali o'rnatildi.`))})})})},this.setDocumentByKey=()=>{this.lf[e].setItem(n,i).then(r=>{o(d.call(this,`${JSON.stringify(n)} kaliti bilan "${e}" collectioni ichidagi document (qayta yozish) orqali o'rnatildi.`,i))}).catch(r=>{a(y.call(this,`"${e}" collectioni ichidagi document ${JSON.stringify(n)} kaliti bilan (qayta yozish) orqali o'rnatildi.`))})},typeof n=="object"?this.setDocumentByCriteria():this.setDocumentByKey()),i?l==="doc"?typeof i=="object"&&!(i instanceof Array)||this.userErrors.push("set() metodiga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas."):l==="collection"&&(typeof i=="object"&&i instanceof Array||this.userErrors.push(".set() ga uzatilgan ma'lumotlar object(lar)ning massiv(lari) bo'lishi kerak. Object, string, number yoki boolean emas.")):this.userErrors.push('set() metodi uchun yangi document objecti taqdim etilmagan. Objectdan foydalaning. Masalan: {id: 1, ism: "Otabek", yoshi: 19}.'),this.userErrors.length)$.call(this);else{if(l=="collection")return this.setCollection();if(l=="doc")return this.setDocument()}})}function A(){return new Promise((i,t)=>{if(this.deleteDatabase=()=>{const e=this.dbName,n=indexedDB.deleteDatabase(e);n.onsuccess=()=>{i(d.call(this,`"${e}" nomli ma'lumotlar bazasi o'chirildi.`,{database:e}))},n.onerror=()=>{t(y.call(this,`"${e}" nomli ma'lumotlar bazasi o'chirilmadi.`))},n.onblocked=()=>{i(d.call(this,`"${e}" nomli ma'lumotlar bazasi o'chirildi.`,{database:e}))}},this.deleteCollection=()=>{const e=this.dbName,n=this.collectionName;this.addToDeleteCollectionQueue=l=>{this.deleteCollectionQueue.queue.push(l),this.runDeleteCollectionQueue()},this.runDeleteCollectionQueue=()=>{this.deleteCollectionQueue.running==!1&&(this.deleteCollectionQueue.running=!0,this.deleteNextCollectionFromQueue())},this.deleteNextCollectionFromQueue=()=>{if(this.deleteCollectionQueue.queue.length){const l=this.deleteCollectionQueue.queue[0];this.deleteCollectionQueue.queue.shift(),this.lf[l].dropInstance({name:e,storeName:l}).then(()=>{this.deleteNextCollectionFromQueue(),i(d.call(this,`"${l}" nomli collection o'chirildi.`,{collection:l}))}).catch(o=>{t(o.call(this,`"${l}" nomli collection o'chirilmadi.`))})}else this.deleteCollectionQueue.running=!1},this.addToDeleteCollectionQueue(n)},this.deleteDocument=()=>{const e=this.collectionName,n=this.docSelectionCriteria;return this.deleteDocumentByCriteria=()=>{const l=[];this.lf[e].iterate((o,a)=>{p(o,n)&&l.push(a)}).then(()=>{if(!l.length){c.error.call(this,`${JSON.stringify(n)} => "${e}" nomli collectionda document(lar) topilmadi. Hech qanday document o'chirilmadi.`),i(d.call(this,`${JSON.stringify(n)} bilan 0ta document o'chirildi.`,{keys:[]}));return}l.length>1&&c.warn.call(this,`${JSON.stringify(n)} bilan (${l.length}) ta document${l.length>1?"lar":""} topildi.`)}).then(()=>{l.length&&l.forEach((o,a)=>{this.lf[e].removeItem(o).then(()=>{a===l.length-1&&i(d.call(this,`${JSON.stringify(n)} bilan ${l.length}ta document${l.length>1?"lar":""} o'chirildi.`,{keys:l}))}).catch(r=>{t(y.call(this,`${l.length} ta document${l.length>1?"lar":""}ni ${e} nomli collectiondan o'chirilmadi.`))})})})},this.deleteDocumentByKey=()=>{this.lf[e].getItem(n).then(l=>{l?this.lf[e].removeItem(n).then(()=>{i(d.call(this,`${JSON.stringify(n)} kalitli document(lar) o'chirildi.`,{key:n}))}).catch(function(o){t(y.call(this,`"${e}" nomli collectionda ${JSON.stringify(n)} kaliti bilan document(lar) topilmadi. Hech qanday document o'chirilmadi.`))}):t(y.call(this,`"${e}" nomli collectionda ${JSON.stringify(n)} kaliti bilan document(lar) topilmadi. Hech qanday document o'chirilmadi.`))})},typeof n=="object"?this.deleteDocumentByCriteria():this.deleteDocumentByKey()},this.userErrors.length)$.call(this);else{const e=S.call(this);if(e=="db")return this.deleteDatabase();if(e=="collection")return this.deleteCollection();if(e=="doc")return this.deleteDocument()}})}class M{dbName;lf;collectionName;orderByProperty;orderByDirection;limitBy;docSelectionCriteria;deleteCollectionQueue;config;userErrors;collection;doc;orderBy;limit;get;add;update;set;delete;constructor(t){this.dbName=t,this.lf={},this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.deleteCollectionQueue={queue:[],running:!1},this.config={debug:!0},this.userErrors=[],this.collection=B.bind(this),this.doc=O.bind(this),this.orderBy=q.bind(this),this.limit=D.bind(this),this.get=x.bind(this),this.add=Q.bind(this),this.update=j.bind(this),this.set=K.bind(this),this.delete=A.bind(this)}}b.Ombor=M,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})}));
