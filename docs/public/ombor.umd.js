(function(b,p){typeof exports=="object"&&typeof module<"u"?p(exports,require("localforage")):typeof define=="function"&&define.amd?define(["exports","localforage"],p):(b=typeof globalThis<"u"?globalThis:b||self,p(b.Ombor={},b.localforage))})(this,(function(b,p){"use strict";function V(e){if(e){if(typeof e!="string")return this.userErrors.push("Collection() metodidagi to'plam nomi string bo'lishi kerak, object, number yoki boolean emas."),this;{this.collectionName=e;const i=this.dbName;return e in this.lf||(this.lf[e]=p.createInstance({driver:p.INDEXEDDB,name:i,storeName:e})),this}}else return this.userErrors.push("Collection() metodida to'plam nomi ko'rsatilmagan"),this}function F(e){return e?typeof e!="string"&&typeof e!="object"?this.userErrors.push("Doc() metodida ko'rsatilgan document mezonlari number yoki boolean bo'lmasligi kerak. Kalitli string yoki mezonlarga ega bo'lgan objectdan foydalaning. Masalan: {id: 1}."):this.docSelectionCriteria=e:this.userErrors.push("Doc() metodida belgilangan document mezonlari yo'q. Kalitli string yoki mezonlarga ega bo'lgan objectdan foydalaning. Masalan: {id: 1}."),this}function L(e,i){return e?typeof e!="string"?this.userErrors.push(`OrderBy() metodidagi birinchi parametr String (maydon nomi) bo'lishi kerak. Masalan: "ism".`):this.orderByProperty=e:this.userErrors.push(`OrderBy() metodida maydon nomi ko'rsatilmagan. Stringdan foydalaning. Masalan: "ism".`),i&&(i!=="asc"&&i!=="desc"?this.userErrors.push("OrderBy() metodidagi ikkinchi parametr 'asc' yoki 'desc' va string bo'lishi kerak."):this.orderByDirection=i),this}function H(e){return e?Number.isInteger(e)?this.limitBy=e:this.userErrors.push("limit() metodidagi limit parametri float, boolean, string yoki objekt emas, balki butun son (masalan, 3) bo'lishi kerak."):this.userErrors.push("Limit() metodida integer(raqam) ko'rsatilmagan."),this}function $(e,i){return Object.keys(i).every(t=>typeof i[t]=="object"?$(e[t],i[t]):i[t]===e[t])}const c={baseStyle:`
    padding: 2px 5px;
    background-color: #124F5C;
    border-radius: 4px;
    color: white;
  `,colors:{log:"#124F5C",error:"#ed2939",warn:"#f39c12"},log(e,i){if(this.config&&this.config.debug){const t=c.baseStyle+`background-color: ${c.colors.log}`;console.log("%cOmbor",t,e)}},error(e,i){if(this.config&&this.config.debug){const t=c.baseStyle+`background-color: ${c.colors.error}`;console.error("%cOmbor",t,e)}},warn(e,i){if(this.config&&this.config.debug){const t=c.baseStyle+`background-color: ${c.colors.warn}`;console.warn("%cOmbor",t,e)}}};function k(){this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.userErrors=[]}function E(){let e;return!this.collectionName&&!this.docSelectionCriteria?e="db":this.collectionName&&!this.docSelectionCriteria?e="collection":this.collectionName&&this.docSelectionCriteria&&(e="doc"),e}function S(){for(let e=0;e<this.userErrors.length;e++)c.error.call(this,this.userErrors[e]);k.call(this)}function G(e={keys:!1}){if(this.getCollection=()=>{const i=this.collectionName,t=this.orderByProperty,r=this.orderByDirection,o=e.filter,l=this.limitBy;let a=[];return this.lf[i].iterate((n,s)=>{let h={};e.keys?h={key,data:n}:h=n,o?$(n,o)&&a.push(h):a.push(h)}).then(()=>{let n=`"${i}" nomli collection olindi`;return t&&(n+=`, "${t}" orqali tartiblandi`,e.keys?a.sort((s,h)=>!s.data.hasOwnProperty(t)||!h.data.hasOwnProperty(t)?0:s.data[t].toString().localeCompare(h.data[t].toString())):a.sort((s,h)=>!s.hasOwnProperty(t)||!h.hasOwnProperty(t)?0:s[t].toString().localeCompare(h[t].toString()))),r=="desc"&&(n+=" (descending)",a.reverse()),l&&(n+=`, ${l} ta document(lar)gacha checklandi`,a=a.splice(0,l)),n+=":",c.log.call(this,n,a),k.call(this),a})},this.getDocument=()=>{const i=this.collectionName,t=this.docSelectionCriteria,r=[];let o={};return this.getDocumentByCriteria=()=>this.lf[i].iterate((l,a)=>{$(l,t)&&r.push(l)}).then(()=>{if(!r.length)c.error.call(this,`${JSON.stringify(t)} bilan "${i}" nomli collectionida documentlar topilmadi.`);else return o=r[0],c.log.call(this,`${JSON.stringify(t)} bilan document olindi:`,o),k.call(this),o}),this.getDocumentByKey=()=>this.lf[i].getItem(t).then(l=>(o=l,o?c.log.call(this,`${JSON.stringify(t)} bilan document olindi:`,o):c.error.call(this,`${JSON.stringify(t)} kaliti bilan "${i}" nomli collectionda document topilmadi.`),k.call(this),o)).catch(l=>{c.error.call(this,`${JSON.stringify(t)} kaliti bilan "${i}" nomli collectionda document topilmadi.`),k.call(this)}),typeof t=="object"?this.getDocumentByCriteria():this.getDocumentByKey()},typeof e=="object"&&!(e instanceof Array)?e.hasOwnProperty("keys")?typeof e.keys!="boolean"&&this.userErrors.push("get() metodiga uzatilgan keys booleaniga true yoki false qiymat berilishi kerak. String yoki number emas."):this.userErrors.push("get() metodiga uzatilgan object true yoki false qiymatli keys boolean bo'lishi kerak. Masalan: { keys: true }"):this.userErrors.push("get() metodiga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas. Objectda true yoki false qiymatli boolean bo'lishi kerak. Masalan: {keys: true}."),this.userErrors.length)return S.call(this),null;{const i=E.call(this);if(i=="collection")return this.getCollection();if(i=="doc")return this.getDocument()}}function X(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C={exports:{}},z;function I(){if(z)return C.exports;z=1;var e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(e){var i=new Uint8Array(16);C.exports=function(){return e(i),i}}else{var t=new Array(16);C.exports=function(){for(var o=0,l;o<16;o++)(o&3)===0&&(l=Math.random()*4294967296),t[o]=l>>>((o&3)<<3)&255;return t}}return C.exports}var D,P;function Q(){if(P)return D;P=1;for(var e=[],i=0;i<256;++i)e[i]=(i+256).toString(16).substr(1);function t(r,o){var l=o||0,a=e;return[a[r[l++]],a[r[l++]],a[r[l++]],a[r[l++]],"-",a[r[l++]],a[r[l++]],"-",a[r[l++]],a[r[l++]],"-",a[r[l++]],a[r[l++]],"-",a[r[l++]],a[r[l++]],a[r[l++]],a[r[l++]],a[r[l++]],a[r[l++]]].join("")}return D=t,D}var _,R;function W(){if(R)return _;R=1;var e=I(),i=Q(),t,r,o=0,l=0;function a(n,s,h){var d=s&&h||0,f=s||[];n=n||{};var q=n.node||t,y=n.clockseq!==void 0?n.clockseq:r;if(q==null||y==null){var g=e();q==null&&(q=t=[g[0]|1,g[1],g[2],g[3],g[4],g[5]]),y==null&&(y=r=(g[6]<<8|g[7])&16383)}var v=n.msecs!==void 0?n.msecs:new Date().getTime(),N=n.nsecs!==void 0?n.nsecs:l+1,K=v-o+(N-l)/1e4;if(K<0&&n.clockseq===void 0&&(y=y+1&16383),(K<0||v>o)&&n.nsecs===void 0&&(N=0),N>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=v,l=N,r=y,v+=122192928e5;var O=((v&268435455)*1e4+N)%4294967296;f[d++]=O>>>24&255,f[d++]=O>>>16&255,f[d++]=O>>>8&255,f[d++]=O&255;var x=v/4294967296*1e4&268435455;f[d++]=x>>>8&255,f[d++]=x&255,f[d++]=x>>>24&15|16,f[d++]=x>>>16&255,f[d++]=y>>>8|128,f[d++]=y&255;for(var B=0;B<6;++B)f[d+B]=q[B];return s||i(f)}return _=a,_}var w,M;function Y(){if(M)return w;M=1;var e=I(),i=Q();function t(r,o,l){var a=o&&l||0;typeof r=="string"&&(o=r==="binary"?new Array(16):null,r=null),r=r||{};var n=r.random||(r.rng||e)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,o)for(var s=0;s<16;++s)o[a+s]=n[s];return o||i(n)}return w=t,w}var J,T;function Z(){if(T)return J;T=1;var e=W(),i=Y(),t=i;return t.v1=e,t.v4=i,J=t,J}var j,U;function ee(){if(U)return j;U=1;var e=Z();return j={generate:function(){var i=e.v1();return i.substr(14,4)+i.substr(9,4)+i.substr(0,8)+i.substr(19,4)+i.substr(24,i.length)},toBinary16:function(i){return new Buffer(i,"hex")},fromBinary16:function(i){return i.toString("hex")}},j}var te=ee();const ie=X(te);function m(e,i){return k.call(this),c.log.call(this,e,i),{success:!0,message:e,data:i}}function u(e){return k.call(this),c.error.call(this,e),`Xatolik: ${e}`}function re(e,i){if(e?typeof e=="object"&&!(e instanceof Array)||this.userErrors.push("add() metodiga uzatilgan ma'lumot object bo'lishi kerak. Array, string, number yoki boolean emas."):this.userErrors.push(`add() metodida ma'lumot yo'q. Siz objectdan foydalanishingiz kerak, misol: { id: 1, ism: "Otabek", yosh: 19 }`),this.userErrors.length)S.call(this);else{const t=this.collectionName;return new Promise((r,o)=>{let l=null;return i?l=i:l=ie.generate(),this.lf[t].setItem(l,e).then(()=>{r(m.call(this,`"${t}" nomli collectionga yangi document qo'shildi.`,{key:l,data:e}))}).catch(a=>{o(u.call(this,`"${t}" nomli collectionga yangi document qo'shilmadi.`))})})}}function A(e){for(let i=1;i<arguments.length;i++)for(const t in arguments[i]){const r=arguments[i][t];e[t]=r}return e}function le(e){const i=this.collectionName,t=this.docSelectionCriteria;return new Promise((r,o)=>{this.updateDocumentByCriteria=()=>{const l=[];this.lf[i].iterate((a,n)=>{if($(a,t)){const s=A(a,e);l.push({key:n,newDocument:s})}}).then(()=>{l.length||o(u.call(this,`${JSON.stringify(t)} bilan ${i} collectionida documentlar topilmadi.`)),l.length>1&&c.warn.call(this,`${JSON.stringify(t)} bilan yangilash uchun (${l.length}) ta document(lar) topildi.`)}).then(()=>{l.forEach((a,n)=>{this.lf[i].setItem(a.key,a.newDocument).then(s=>{n===l.length-1&&r(m.call(this,`${JSON.stringify(t)} dagi "${i}" collectionida ${l.length} document${l.length>1?"lar":""} yangilandi.`,e))}).catch(s=>{o(u.call(this,`${i} collectionidagi ${l.length} ta document yangilanmadi.`))})})})},this.updateDocumentByKey=()=>{let l={};this.lf[i].getItem(t).then(a=>{l=A(value,e),this.lf[i].setItem(t,l),r(m.call(this,`"${i}" collectionidagi document ${JSON.stringify(t)} kaliti bilan yangilandi.`,l))}).catch(a=>{o(u.call(this,`"${i}" collectionida ${JSON.stringify(t)} kalitli document topilmadi.`))})},e?typeof e=="object"&&!(e instanceof Array)||this.userErrors.push("Update() ga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas."):this.userErrors.push('Update() methodi uchun yangilanish objecti taqdim etilmagan. Objectdan foydalaning. Masalan: {ism: "Otabek"}.'),this.userErrors.length?S.call(this):typeof t=="object"?this.updateDocumentByCriteria():this.updateDocumentByKey()})}function oe(e,i={keys:!1}){const t=this.collectionName,r=this.docSelectionCriteria,o=E.call(this);return new Promise((l,a)=>{if(this.setCollection=()=>{this.lf[t].clear().then(()=>{if(!i.keys)e.forEach(n=>{this.add(n)}),l(m.call(this,`"${t}" nomli collectionda ${e.length} ta document o'rnatildi.`,e));else{console.log("Kalitlar taqdim etildi");let n=0;e.forEach(s=>{s.hasOwnProperty("_key")||n++}),n?a(u.call(this,".set() metodiga array ichida berilgan documentlarning har birida string bo'lgan _key property bo'lishi kerak.")):(e.forEach(s=>{const h=s._key;delete s._key,this.add(s,h)}),l(m.call(this,`"${t}" nomli collectionda ${e.length} ta document bilan (qayta yozish orqali) o'rnatildi.`,e)))}}).catch(n=>{a(u.call(this,`${JSON.stringify(e)} ma'lumotlari bilan ${t} collectioni (qayta yozish) orqali o'rnatilmadi.`))})},this.setDocument=()=>(this.setDocumentByCriteria=()=>{const n=[];this.lf[t].iterate((s,h)=>{$(s,r)&&n.push({key:h,newDocument:e})}).then(()=>{n.length||a(u.call(this,`${t} collectionida ${JSON.stringify(r)} bilan documentlar topilmadi.`)),n.length>1&&c.warn.call(this,`O'rnatish uchun ${JSON.stringify(r)} bilan (${n.length}) ta document topildi.`)}).then(()=>{n.forEach((s,h)=>{this.lf[t].setItem(s.key,s.newDocument).then(d=>{h===n.length-1&&l(m.call(this,`${JSON.stringify(r)} bilan "${t}" collectionida ${n.length} ta document${n.length>1?"lar":""} (qayta yozish) orqali o'rnatildi.`,e))}).catch(d=>{a(u.call(this,`${n.length} ta document ${t} collectioniga (qayta yozish) orqali o'rnatildi.`))})})})},this.setDocumentByKey=()=>{this.lf[t].setItem(r,e).then(n=>{l(m.call(this,`${JSON.stringify(r)} kaliti bilan "${t}" collectioni ichidagi document (qayta yozish) orqali o'rnatildi.`,e))}).catch(n=>{a(u.call(this,`"${t}" collectioni ichidagi document ${JSON.stringify(r)} kaliti bilan (qayta yozish) orqali o'rnatildi.`))})},typeof r=="object"?this.setDocumentByCriteria():this.setDocumentByKey()),e?o==="doc"?typeof e=="object"&&!(e instanceof Array)||this.userErrors.push("set() metodiga uzatilgan ma'lumotlar object bo'lishi kerak. Array, string, number yoki boolean emas."):o==="collection"&&(typeof e=="object"&&e instanceof Array||this.userErrors.push(".set() ga uzatilgan ma'lumotlar object(lar)ning massiv(lari) bo'lishi kerak. Object, string, number yoki boolean emas.")):this.userErrors.push('set() metodi uchun yangi document objecti taqdim etilmagan. Objectdan foydalaning. Masalan: {id: 1, ism: "Otabek", yoshi: 19}.'),this.userErrors.length)S.call(this);else{if(o=="collection")return this.setCollection();if(o=="doc")return this.setDocument()}})}function ne(){return new Promise((e,i)=>{if(this.deleteDatabase=()=>{const t=this.dbName;indexedDB.deleteDatabase(t),e(m.call(this,`"${t}" nomli ma'lumotlar bazasi o'chirildi.`,{database:t}))},this.deleteCollection=()=>{const t=this.dbName,r=this.collectionName;this.addToDeleteCollectionQueue=o=>{this.deleteCollectionQueue.queue.push(o),this.runDeleteCollectionQueue()},this.runDeleteCollectionQueue=()=>{this.deleteCollectionQueue.running==!1&&(this.deleteCollectionQueue.running=!0,this.deleteNextCollectionFromQueue())},this.deleteNextCollectionFromQueue=()=>{if(this.deleteCollectionQueue.queue.length){const o=this.deleteCollectionQueue.queue[0];this.deleteCollectionQueue.queue.shift(),this.lf[o].dropInstance({name:t,storeName:o}).then(()=>{this.deleteNextCollectionFromQueue(),e(m.call(this,`"${o}" nomli collection o'chirildi.`,{collection:o}))}).catch(l=>{i(l.call(this,`"${o}" nomli collection o'chirilmadi.`))})}else this.deleteCollectionQueue.running=!1},this.addToDeleteCollectionQueue(r)},this.deleteDocument=()=>{const t=this.collectionName,r=this.docSelectionCriteria;return this.deleteDocumentByCriteria=()=>{const o=[];this.lf[t].iterate((l,a)=>{$(l,r)&&o.push(a)}).then(()=>{o.length||i(u.call(this,`${JSON.stringify(r)} => "${t}" nomli collectionda document(lar) topilmadi. Hech qanday document o'chirilmadi.`)),o.length>1&&c.warn.call(this,`${JSON.stringify(r)} bilan (${o.length}) ta document${o.length>1?"lar":""} topildi.`)}).then(()=>{o.forEach((l,a)=>{this.lf[t].removeItem(l).then(()=>{a===o.length-1&&e(m.call(this,`${JSON.stringify(r)} bilan ${o.length}ta document${o.length>1?"lar":""} o'chirildi.`,{keys:o}))}).catch(n=>{i(u.call(this,`${o.length} ta document${o.length>1?"lar":""}ni ${t} nomli collectiondan o'chirilmadi.`))})})})},this.deleteDocumentByKey=()=>{this.lf[t].getItem(r).then(o=>{o?this.lf[t].removeItem(r).then(()=>{e(m.call(this,`${JSON.stringify(r)} kalitli document(lar) o'chirildi.`,{key:r}))}).catch(function(l){i(u.call(this,`"${t}" nomli collectionda ${JSON.stringify(r)} kaliti bilan document(lar) topilmadi. Hech qanday document o'chirilmadi.`))}):i(u.call(this,`"${t}" nomli collectionda ${JSON.stringify(r)} kaliti bilan document(lar) topilmadi. Hech qanday document o'chirilmadi.`))})},typeof r=="object"?this.deleteDocumentByCriteria():this.deleteDocumentByKey()},this.userErrors.length)S.call(this);else{const t=E.call(this);if(t=="db")return this.deleteDatabase();if(t=="collection")return this.deleteCollection();if(t=="doc")return this.deleteDocument()}})}class ae{dbName;lf;collectionName;orderByProperty;orderByDirection;limitBy;docSelectionCriteria;deleteCollectionQueue;config;userErrors;collection;doc;orderBy;limit;get;add;update;set;delete;constructor(i){this.dbName=i,this.lf={},this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.deleteCollectionQueue={queue:[],running:!1},this.config={debug:!0},this.userErrors=[],this.collection=V.bind(this),this.doc=F.bind(this),this.orderBy=L.bind(this),this.limit=H.bind(this),this.get=G.bind(this),this.add=re.bind(this),this.update=le.bind(this),this.set=oe.bind(this),this.delete=ne.bind(this)}}b.Ombor=ae,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})}));
